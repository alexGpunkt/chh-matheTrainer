<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Mathe Trainer ‚Äì Note 2‚Äì1</title>

<script src="pool_113.js"></script>
<script src="staticDiagrams.js"></script>
<script src="diagramRenderer.js"></script>

<style>
body {
  font-family: Arial;
  background:#f2f2f2;
  padding:20px;
  margin:0;
}

h1 {
  text-align:center;
  font-size: clamp(1.3rem, 4vw, 2rem);
}

#topbar {
  text-align:center;
  margin-bottom:15px;
}

button, select {
  padding:10px;
  font-size:1rem;
  margin:4px;
  border-radius:8px;
}

#status, #progress {
  text-align:center;
  font-weight:bold;
  margin:6px;
}

#card {
  max-width:900px;
  margin:auto;
  background:white;
  padding:25px;
  border-radius:10px;
}

#task {
  font-size: clamp(1.1rem, 4vw, 1.4rem);
  margin-bottom:10px;
}

/* RESPONSIVE DIAGRAMM */
.diagram-container {
  margin: 15px 0;
  padding: 10px;
  background: #f5f5f5;
  border-radius: 8px;
  text-align: center;
  width: 100%;
}

.diagram-container svg {
  width: 100%;
  height: auto;
  max-height: 45vh;
}

/* Eingabe optimiert */
#answerArea {
  margin-top:10px;
}

input {
  padding:10px;
  font-size:1.1rem;
  width:100%;          /* WICHTIG */
  border-radius:8px;
  border:1px solid #aaa;
}

#feedback {
  margin-top:10px;
  font-weight:bold;
}

#solution {
  display:none;
  background:#eef6ff;
  padding:15px;
  border-radius:6px;
  margin-top:10px;
}

#aufgabenContainer {
  margin-top:30px;
  border-top:3px solid #1976d2;
  padding-top:20px;
}

.aufgabe {
  background:#f9f9f9;
  padding:15px;
  margin-bottom:20px;
  border-left:4px solid #1976d2;
  border-radius:4px;
}

</style>
</head>

<body>

<h1>üéì Mathe-Trainer ‚Äì Note 2‚Äì1</h1>

<div id="topbar">
<select id="mode">
<option value="exam">Pr√ºfungsmodus</option>
<option value="cards">Karteikartenmodus</option>
</select>

<select id="level">
<option value="boa">BOA</option>
<option value="bbr">BBR</option>
</select>

<button onclick="startRound()">üé≤ Zufallsrunde starten</button>
<button onclick="nextTaskRandom()">‚û°Ô∏è N√§chste Aufgabe</button>
<button onclick="nextTaskSameType()">üîÅ Gleicher Typ</button>
<button onclick="toggleSolution()">üìå L√∂sung</button>
<button onclick="exportPDF()">üìÑ PDF Aufgabenblatt</button>
<button onclick="resetTrainer()">üîÑ Reset</button>
</div>

<div id="status">Punkte: 0</div>
<div id="progress">Noch keine Runde gestartet</div>

<div id="card">
<div id="task">Starte eine Runde.</div>
<div id="diagramArea"></div>

<div id="answerArea">
Deine Antwort:
<input type="text" id="userAnswer">
<button onclick="checkAnswer()">Antwort pr√ºfen</button>
</div>

<div id="feedback"></div>
<div id="solution"></div>

<div id="aufgabenContainer"></div>
</div>

<script>
let currentTask=null;
let currentAnswer=null;
let lastCategory=null;
let points=0;
let taskNumber=0;
let totalTasks=10;
let roundActive=false;
let exportedTasks=[];

function getMode(){ return document.getElementById("mode").value; }
function getLevel(){ return document.getElementById("level").value; }

function startRound(){
points=0;
taskNumber=0;
roundActive=true;
exportedTasks=[];
document.getElementById("aufgabenContainer").innerHTML="";
updateStatus();
nextTaskRandom();
}

function nextTaskRandom(){
if(!roundActive) return;
if(taskNumber>=totalTasks) return;

taskNumber++;

const cats=Object.keys(TASKPOOL_113);
const cat=cats[Math.floor(Math.random()*cats.length)];
const gen=TASKPOOL_113[cat][Math.floor(Math.random()*TASKPOOL_113[cat].length)];
const task=gen();
task.category=cat;

drawTask(task);
}

function nextTaskSameType(){
if(!roundActive || !lastCategory) return;

const gen=TASKPOOL_113[lastCategory][Math.floor(Math.random()*TASKPOOL_113[lastCategory].length)];
const task=gen();
task.category=lastCategory;

drawTask(task,true);
}

function drawTask(task,isSame=false){
currentTask=task;
currentAnswer=task.answer;
lastCategory=task.category;

document.getElementById("task").innerHTML=task.task;
document.getElementById("solution").innerHTML=
"<b>L√∂sung:</b><br>"+(task.solution||"");
document.getElementById("solution").style.display="none";
document.getElementById("feedback").innerHTML="";
document.getElementById("userAnswer").value="";

renderDiagramIfExists(task);

addToContainer(task);

exportedTasks.push(task);

document.getElementById("progress").innerHTML=
"Aufgabe "+taskNumber+" von "+totalTasks+(isSame?" (gleicher Typ)":"");
}

function renderDiagramIfExists(task){
const area=document.getElementById("diagramArea");
area.innerHTML="";
if(task.diagram){
const div=document.createElement("div");
div.className="diagram-container";
renderDiagram(task.diagram,div);
area.appendChild(div);
}
}

function addToContainer(task){
const div=document.createElement("div");
div.className="aufgabe";
div.innerHTML="<b>Aufgabe "+taskNumber+" ("+task.category+"):</b><br>"+task.task;
if(task.diagram){
const diag=document.createElement("div");
diag.className="diagram-container";
renderDiagram(task.diagram,diag);
div.appendChild(diag);
}
document.getElementById("aufgabenContainer").appendChild(div);
}

function checkAnswer(){
if(getMode()==="cards") return;

const val=document.getElementById("userAnswer").value.trim();

if(typeof currentAnswer==="string"){
if(val===currentAnswer){
points+=3;
document.getElementById("feedback").innerHTML="‚úî Richtig!";
}else{
document.getElementById("feedback").innerHTML="‚úò Falsch. L√∂sung: "+currentAnswer;
}
}else{
const num=parseFloat(val.replace(",","."));
if(!isNaN(num)&&Math.abs(num-currentAnswer)<0.05){
points+=3;
document.getElementById("feedback").innerHTML="‚úî Richtig!";
}else{
document.getElementById("feedback").innerHTML="‚úò Falsch. L√∂sung: "+currentAnswer;
}
}
updateStatus();
}

function toggleSolution(){
const s=document.getElementById("solution");
s.style.display=(s.style.display==="block")?"none":"block";
}

function updateStatus(){
document.getElementById("status").innerHTML="Punkte: "+points;
}

function resetTrainer(){
points=0;
taskNumber=0;
roundActive=false;
lastCategory=null;
exportedTasks=[];
updateStatus();
document.getElementById("task").innerHTML="Starte eine Runde.";
document.getElementById("progress").innerHTML="Noch keine Runde gestartet";
document.getElementById("aufgabenContainer").innerHTML="";
document.getElementById("diagramArea").innerHTML="";
}

function exportPDF(){
if(exportedTasks.length===0){
alert("Keine Aufgaben vorhanden.");
return;
}

const win=window.open("");
win.document.write("<h2>Mathe Aufgabenblatt ‚Äì Note 2‚Äì1</h2>");

exportedTasks.forEach((t,i)=>{
win.document.write("<hr>");
win.document.write("<b>Aufgabe "+(i+1)+"</b><br>"+t.task+"<br>");
if(t.diagram){
win.document.write("<div id='d"+i+"'></div>");
}
win.document.write("<br><b>L√∂sung:</b><br>"+(t.solution||"")+"<br>");
});

win.document.close();
win.print();
}
</script>

</body>
</html>
